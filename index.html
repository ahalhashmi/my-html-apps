<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Abdullah's App Hub</title>
  <style>
    body {
      margin: 0;
      background: #0d1117;
      color: #e6edf3;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 20px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    h1 {
      font-size: 26px;
      margin: 0 0 4px 0;
      font-weight: 600;
    }
    p.subtitle {
      opacity: 0.8;
      margin: 0;
      font-size: 14px;
    }
    button.refresh-btn {
      border: 1px solid #30363d;
      background: #161b22;
      color: #e6edf3;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    button.refresh-btn:hover {
      background: #1d2632;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      padding: 16px;
      border-radius: 12px;
      text-decoration: none;
      color: inherit;
      transition: transform 0.15s ease, background 0.2s, box-shadow 0.2s;
    }
    .card:hover {
      background: #1d2632;
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    }
    .card-title {
      font-size: 18px;
      margin-bottom: 4px;
      font-weight: 500;
    }
    .card-path {
      font-size: 12px;
      opacity: 0.7;
    }
    .empty {
      margin-top: 20px;
      opacity: 0.7;
      font-size: 14px;
    }
    .error {
      margin-top: 20px;
      color: #f97373;
      font-size: 14px;
    }
    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 12px;
      opacity: 0.5;
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <div>
      <h1>Abdullah's App Hub</h1>
      <p class="subtitle">
        Automatically listing all app folders in <code>my-html-apps</code>.
      </p>
    </div>
    <button class="refresh-btn" id="refresh-btn">
      ⟳ Refresh apps
    </button>
  </div>

  <div id="apps" class="grid"></div>

  <div id="empty" class="empty" style="display:none;">
    No apps found yet. Create a folder (e.g. <code>enhancer/</code>) with an
    <code>index.html</code> (or redirect to a version folder) and it will appear here automatically.
  </div>

  <div id="error" class="error" style="display:none;"></div>

  <footer>© 2025 Abdullah — All rights reserved.</footer>

  <script>
    // GitHub repo config
    const GITHUB_USER = "ahalhashmi";
    const GITHUB_REPO = "my-html-apps";
    const API_URL = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/`;

    const appsContainer = document.getElementById("apps");
    const emptyMsg = document.getElementById("empty");
    const errorMsg = document.getElementById("error");
    const refreshBtn = document.getElementById("refresh-btn");

    // This will change every time we refresh the list, to bust cache
    let versionStamp = Date.now();

    function niceName(folderName) {
      // Turn "quran-enhancer" -> "Quran Enhancer"
      return folderName
        .replace(/[-_]+/g, " ")
        .replace(/\b\w/g, c => c.toUpperCase());
    }

    async function loadApps() {
      versionStamp = Date.now();  // new stamp each time

      appsContainer.innerHTML = "";
      emptyMsg.style.display = "none";
      errorMsg.style.display = "none";

      try {
        const res = await fetch(API_URL + "?t=" + versionStamp, {
          cache: "no-store"
        });
        if (!res.ok) {
          throw new Error("GitHub API error: " + res.status);
        }
        const items = await res.json();

        // Only direct folders
        let dirs = items.filter(item => item.type === "dir");

        // Ignore internal folders if you add any later
        const ignore = new Set([".github", "assets", "static"]);
        dirs = dirs.filter(d => !ignore.has(d.name));

        // Sort alphabetically
        dirs.sort((a, b) => a.name.localeCompare(b.name));

        if (dirs.length === 0) {
          emptyMsg.style.display = "block";
          return;
        }

        dirs.forEach(dir => {
          const a = document.createElement("a");
          a.className = "card";

          // Add version query to bust cache for the app HTML
          a.href = `./${dir.name}/?v=${versionStamp}`;
          a.target = "_blank";

          const title = document.createElement("div");
          title.className = "card-title";
          title.textContent = niceName(dir.name);

          const path = document.createElement("div");
          path.className = "card-path";
          path.textContent = `/${dir.name}/`;

          a.appendChild(title);
          a.appendChild(path);
          appsContainer.appendChild(a);
        });
      } catch (err) {
        console.error(err);
        errorMsg.textContent =
          "Failed to load apps list from GitHub. Try pressing Refresh again or reloading the page.";
        errorMsg.style.display = "block";
      }
    }

    refreshBtn.addEventListener("click", () => {
      loadApps();
    });

    // Initial load
    loadApps();
  </script>

</body>
</html>